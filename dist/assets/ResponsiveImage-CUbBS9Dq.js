import{r as B,k as A,L as F,i as b,w as $,d as O,c as y,o as w,x as _,n as M,q as s,f as U,B as H,a as u,t as x,M as N,J as q,h as Z}from"./index-CTCMJD1m.js";import{_ as J}from"./AppLayout-C9scn7Fz.js";function G(E={}){const i={fallbackUrl:"/placeholder-project.svg",lazy:!0,enableProxy:!1,breakpoints:{mobile:768,tablet:1024,desktop:1920},quality:{thumbnail:60,medium:75,large:85,original:90},retryConfig:{maxAttempts:3,retryDelay:1e3},loadingTimeout:1e4,...E},e=B({loading:!1,error:!1,loaded:!1,currentSrc:"",retryCount:0,hasTriedFallback:!1}),g=B(window.innerWidth),f=()=>{g.value=window.innerWidth};A(()=>{window.addEventListener("resize",f)}),F(()=>{window.removeEventListener("resize",f)});const c=t=>{if(!t)return t;{if(t.includes("app.tierrasonada.com"))return t;if(t.startsWith("/api/")||t.startsWith("/storage/"))return`https://app.tierrasonada.com${t}`}return t},z=t=>{if(!t)return null;const o=window.devicePixelRatio||1;g.value*o;let r;g.value<=i.breakpoints.mobile?r=400*o:g.value<=i.breakpoints.tablet?r=800*o:r=1200*o;const a=[t.thumbnail,t.medium,t.large,t.original].filter(Boolean);return a.length===0?null:a.reduce((n,d)=>{if(!d.width)return d;if(!n.width)return n;const v=Math.abs(d.width-r),L=Math.abs(n.width-r);return d.width>=r&&n.width>=r?d.width<n.width?d:n:d.width<r&&n.width<r?d.width>n.width?d:n:v<L?d:n})},p=t=>t?[t.thumbnail,t.medium,t.large,t.original].filter(Boolean).filter(r=>r.width).map(r=>`${c(r.url)} ${r.width}w`).join(", "):"",I=t=>t||[`(max-width: ${i.breakpoints.mobile}px) 100vw`,`(max-width: ${i.breakpoints.tablet}px) 50vw`,"33vw"].join(", "),P=async(t,o)=>{if(e.value.error=!0,!e.value.hasTriedFallback&&t){e.value.hasTriedFallback=!0;const r=[t.medium,t.thumbnail,t.large,t.original].filter(a=>a&&a.url!==e.value.currentSrc);if(r.length>0){const a=r[0];return c(a.url)}}return o&&o!==e.value.currentSrc?c(o):i.fallbackUrl},k=(t,o)=>{if(typeof t=="string")return c(t)||o||i.fallbackUrl;if(t){const a=z(t);if(a)return c(a.url)}return c(o||"")||i.fallbackUrl},V=async(t,o)=>{e.value.loading=!0,e.value.error=!1,e.value.loaded=!1,e.value.retryCount=0,e.value.hasTriedFallback=!1;const r=async(a,l=1)=>new Promise((n,d)=>{const v=new Image,L=setTimeout(()=>{v.onload=null,v.onerror=null,d(new Error("Image load timeout"))},i.loadingTimeout);v.onload=()=>{clearTimeout(L),e.value.loading=!1,e.value.loaded=!0,e.value.error=!1,e.value.currentSrc=a,n(a)},v.onerror=async()=>{if(clearTimeout(L),l<i.retryConfig.maxAttempts)setTimeout(()=>{r(a,l+1).then(n).catch(d)},i.retryConfig.retryDelay*l);else try{const R=await P(typeof t=="string"?null:t,o);R!==a&&R!==i.fallbackUrl?r(R,1).then(n).catch(d):(e.value.loading=!1,e.value.error=!0,e.value.loaded=!1,e.value.currentSrc=i.fallbackUrl,n(i.fallbackUrl))}catch{e.value.loading=!1,e.value.error=!0,e.value.loaded=!1,e.value.currentSrc=i.fallbackUrl,n(i.fallbackUrl)}},v.src=a});try{const a=k(t,o);return await r(a)}catch{return e.value.loading=!1,e.value.error=!0,i.fallbackUrl}},T=(t,o="low")=>new Promise(r=>{const a=k(t),l=document.createElement("link");l.rel="preload",l.as="image",l.href=a,o==="high"&&l.setAttribute("fetchpriority","high"),l.onload=()=>r(),l.onerror=()=>r(),document.head.appendChild(l)}),h=b(()=>e.value.loading),m=b(()=>e.value.error),S=b(()=>e.value.loaded),j=b(()=>e.value.currentSrc),W=(t,o,r={})=>{const a=k(t,r.fallbackSrc),l=typeof t=="object"?p(t):"";return{src:a,srcset:l||void 0,sizes:r.sizes?I(r.sizes):I(),alt:o,loading:r.loading||(i.lazy?"lazy":"eager"),fetchpriority:r.fetchPriority}},C=(t,o,r,a)=>{if(!t)return i.fallbackUrl;const l=c(t);if(o||r||a){const n=new URLSearchParams;o&&n.set("w",o.toString()),r&&n.set("h",r.toString()),a&&n.set("q",a.toString());const d=l.includes("?")?"&":"?";return`${l}${d}${n.toString()}`}return l};return $(g,()=>{}),{isLoading:h,hasError:m,isLoaded:S,currentSource:j,screenWidth:b(()=>g.value),getOptimizedImageSrc:k,loadImage:V,preloadImage:T,handleImageError:P,generateSrcSet:p,generateSizes:I,getImageAttributes:W,optimizeImageUrl:C,convertToProxyUrl:c,getBestImageVariant:z,config:b(()=>i)}}const K={key:0,class:"absolute inset-0 flex items-center justify-center bg-gradient-to-br from-gray-100 via-gray-50 to-white"},Q={class:"flex flex-col items-center space-y-3"},X={key:0,class:"h-2 w-16 bg-gray-300 rounded animate-pulse"},Y={key:1,class:"absolute inset-0 flex items-center justify-center bg-gradient-to-br from-red-50 via-gray-50 to-white"},ee={class:"flex flex-col items-center space-y-2 text-center p-4"},ae={class:"text-xs text-red-600 font-medium"},te={key:2,class:"absolute inset-0 z-10"},re={key:4,class:"absolute bottom-0 left-0 right-0 bg-black/75 text-white text-xs p-2 font-mono"},D=3,le=O({__name:"ResponsiveImage",props:{src:{},alt:{},fallback:{},containerClass:{default:""},imageClass:{default:""},containerStyle:{},sizes:{},loading:{default:"lazy"},fetchPriority:{default:"auto"},enableHoverZoom:{type:Boolean,default:!1},blurOnError:{type:Boolean,default:!1},showLoadingText:{type:Boolean,default:!1},errorText:{},badge:{},badgePosition:{default:"top-right"},badgeVariant:{default:"default"},showDebugInfo:{type:Boolean,default:!1},enableRetry:{type:Boolean,default:!0},preload:{type:Boolean,default:!1},quality:{default:80}},emits:["load","error","loadStart"],setup(E,{emit:i}){const e=E,g=i,{isLoading:f,hasError:c,isLoaded:z,screenWidth:p,getImageAttributes:I,getOptimizedImageSrc:P,loadImage:k,preloadImage:V,config:T}=G({lazy:e.loading==="lazy",fallbackUrl:e.fallback}),h=B(""),m=B(0),S=!1,j=window.devicePixelRatio||1,W=b(()=>I(e.src,e.alt,{sizes:e.sizes,loading:e.loading,fetchPriority:e.fetchPriority,fallbackSrc:e.fallback})),C=b(()=>{const a=typeof e.src=="string"?"URL":e.src?"Responsive":"Fallback";let l="N/A";return typeof e.src=="object"&&e.src&&(p.value<=T.value.breakpoints.mobile?l=e.src.thumbnail?"thumbnail":"fallback":p.value<=T.value.breakpoints.tablet?l=e.src.medium?"medium":"fallback":l=e.src.large?"large":"fallback"),{source:a,selectedVariant:l,retryCount:m.value}}),t=async()=>{if(!e.src){h.value=P(null,e.fallback);return}try{g("loadStart"),h.value=await k(e.src,e.fallback),m.value=0}catch(a){e.enableRetry&&m.value<D?(m.value++,setTimeout(t,1e3*m.value)):(h.value=P(null,e.fallback),g("error",a))}},o=()=>{g("load",h.value)},r=()=>{e.enableRetry&&m.value<D?(m.value++,setTimeout(t,1e3*m.value)):g("error",new Error("Image failed to load"))};return $(()=>e.src,t,{immediate:!0}),$(()=>e.preload,a=>{a&&e.src&&V(e.src,e.fetchPriority==="high"?"high":"low")},{immediate:!0}),(a,l)=>(w(),y("div",{class:M(["relative overflow-hidden",a.containerClass,{"animate-pulse bg-gray-200":s(f),"bg-red-50":s(c)&&!s(f)}]),style:_(a.containerStyle)},[s(f)?(w(),y("div",K,[u("div",Q,[l[0]||(l[0]=u("div",{class:"w-8 h-8 bg-gray-300 rounded-lg flex items-center justify-center animate-pulse"},[u("svg",{class:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})])],-1)),a.showLoadingText?(w(),y("div",X)):U("",!0)])])):s(c)&&!h.value?(w(),y("div",Y,[u("div",ee,[l[1]||(l[1]=u("div",{class:"w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center"},[u("svg",{class:"w-5 h-5 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"})])],-1)),u("span",ae,x(a.errorText||"Error al cargar imagen"),1)])])):U("",!0),H(u("img",q(W.value,{class:["w-full h-full object-cover transition-all duration-300",a.imageClass,{"opacity-0":s(f),"opacity-100":!s(f)&&s(z),"hover:scale-105":a.enableHoverZoom&&!s(f),"filter blur-sm":a.blurOnError&&s(c)}],onLoad:o,onError:r}),null,16),[[N,!s(f)&&h.value]]),a.$slots.overlay?(w(),y("div",te,[Z(a.$slots,"overlay",{loading:s(f),error:s(c),loaded:s(z)},void 0,!0)])):U("",!0),a.badge&&!s(f)?(w(),y("div",{key:3,class:M(["absolute z-20 px-2 py-1 text-xs font-semibold rounded-md backdrop-blur-sm border transition-all duration-300",a.badgePosition==="top-left"?"top-2 left-2":a.badgePosition==="top-right"?"top-2 right-2":a.badgePosition==="bottom-left"?"bottom-2 left-2":"bottom-2 right-2",a.badgeVariant==="primary"?"bg-blue-500/90 text-white border-blue-400/30":a.badgeVariant==="success"?"bg-green-500/90 text-white border-green-400/30":a.badgeVariant==="warning"?"bg-yellow-500/90 text-white border-yellow-400/30":a.badgeVariant==="danger"?"bg-red-500/90 text-white border-red-400/30":"bg-white/90 text-gray-700 border-white/50"])},x(a.badge),3)):U("",!0),a.showDebugInfo&&s(S)?(w(),y("div",re,[u("div",null,"Source: "+x(C.value.source),1),u("div",null,"Size: "+x(C.value.selectedVariant),1),u("div",null,"Screen: "+x(s(p))+"px",1),u("div",null,"DPR: "+x(s(j)),1)])):U("",!0)],6))}}),ne=J(le,[["__scopeId","data-v-4f7df0d1"]]);export{ne as R};
