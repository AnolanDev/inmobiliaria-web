import{r as B,k as A,K as F,i as b,w as W,d as O,c as y,o as w,x as _,n as D,q as s,f as P,B as q,a as u,t as x,L as H,I as N,h as Z}from"./index-heTBW7mX.js";import{_ as K}from"./AppLayout-YBgXcIlk.js";function G(E={}){const i={fallbackUrl:"/placeholder-project.svg",lazy:!0,enableProxy:!1,breakpoints:{mobile:768,tablet:1024,desktop:1920},quality:{thumbnail:60,medium:75,large:85,original:90},retryConfig:{maxAttempts:3,retryDelay:1e3},loadingTimeout:1e4,...E},e=B({loading:!1,error:!1,loaded:!1,currentSrc:"",retryCount:0,hasTriedFallback:!1}),g=B(window.innerWidth),f=()=>{g.value=window.innerWidth};A(()=>{window.addEventListener("resize",f)}),F(()=>{window.removeEventListener("resize",f)});const c=a=>{if(!a)return a;if(a.includes("app.tierrasonada.com")||a.startsWith("/storage")){const o=a.startsWith("/storage")?`https://app.tierrasonada.com${a}`:a;return`https://images.weserv.nl/?url=${encodeURIComponent(o)}&w=1200&q=80&output=webp&we`}return a},I=a=>{if(!a)return null;const o=window.devicePixelRatio||1;g.value*o;let r;g.value<=i.breakpoints.mobile?r=400*o:g.value<=i.breakpoints.tablet?r=800*o:r=1200*o;const t=[a.thumbnail,a.medium,a.large,a.original].filter(Boolean);return t.length===0?null:t.reduce((n,d)=>{if(!d.width)return d;if(!n.width)return n;const v=Math.abs(d.width-r),T=Math.abs(n.width-r);return d.width>=r&&n.width>=r?d.width<n.width?d:n:d.width<r&&n.width<r?d.width>n.width?d:n:v<T?d:n})},p=a=>a?[a.thumbnail,a.medium,a.large,a.original].filter(Boolean).filter(r=>r.width).map(r=>`${c(r.url)} ${r.width}w`).join(", "):"",z=a=>a||[`(max-width: ${i.breakpoints.mobile}px) 100vw`,`(max-width: ${i.breakpoints.tablet}px) 50vw`,"33vw"].join(", "),U=async(a,o)=>{if(e.value.error=!0,!e.value.hasTriedFallback&&a){e.value.hasTriedFallback=!0;const r=[a.medium,a.thumbnail,a.large,a.original].filter(t=>t&&t.url!==e.value.currentSrc);if(r.length>0){const t=r[0];return c(t.url)}}return o&&o!==e.value.currentSrc?c(o):i.fallbackUrl},k=(a,o)=>{if(typeof a=="string")return c(a)||o||i.fallbackUrl;if(a){const t=I(a);if(t)return c(t.url)}return c(o||"")||i.fallbackUrl},V=async(a,o)=>{e.value.loading=!0,e.value.error=!1,e.value.loaded=!1,e.value.retryCount=0,e.value.hasTriedFallback=!1;const r=async(t,l=1)=>new Promise((n,d)=>{const v=new Image,T=setTimeout(()=>{v.onload=null,v.onerror=null,d(new Error("Image load timeout"))},i.loadingTimeout);v.onload=()=>{clearTimeout(T),e.value.loading=!1,e.value.loaded=!0,e.value.error=!1,e.value.currentSrc=t,n(t)},v.onerror=async()=>{if(clearTimeout(T),l<i.retryConfig.maxAttempts)setTimeout(()=>{r(t,l+1).then(n).catch(d)},i.retryConfig.retryDelay*l);else try{const L=await U(typeof a=="string"?null:a,o);L!==t&&L!==i.fallbackUrl?r(L,1).then(n).catch(d):(e.value.loading=!1,e.value.error=!0,e.value.loaded=!1,e.value.currentSrc=i.fallbackUrl,n(i.fallbackUrl))}catch{e.value.loading=!1,e.value.error=!0,e.value.loaded=!1,e.value.currentSrc=i.fallbackUrl,n(i.fallbackUrl)}},v.src=t});try{const t=k(a,o);return await r(t)}catch{return e.value.loading=!1,e.value.error=!0,i.fallbackUrl}},C=(a,o="low")=>new Promise(r=>{const t=k(a),l=document.createElement("link");l.rel="preload",l.as="image",l.href=t,o==="high"&&l.setAttribute("fetchpriority","high"),l.onload=()=>r(),l.onerror=()=>r(),document.head.appendChild(l)}),h=b(()=>e.value.loading),m=b(()=>e.value.error),S=b(()=>e.value.loaded),$=b(()=>e.value.currentSrc),j=(a,o,r={})=>{const t=k(a,r.fallbackSrc),l=typeof a=="object"?p(a):"";return{src:t,srcset:l||void 0,sizes:r.sizes?z(r.sizes):z(),alt:o,loading:r.loading||(i.lazy?"lazy":"eager"),fetchpriority:r.fetchPriority}},R=(a,o,r,t)=>{if(!a)return i.fallbackUrl;const l=c(a);if(o||r||t){const n=new URLSearchParams;o&&n.set("w",o.toString()),r&&n.set("h",r.toString()),t&&n.set("q",t.toString());const d=l.includes("?")?"&":"?";return`${l}${d}${n.toString()}`}return l};return W(g,()=>{}),{isLoading:h,hasError:m,isLoaded:S,currentSource:$,screenWidth:b(()=>g.value),getOptimizedImageSrc:k,loadImage:V,preloadImage:C,handleImageError:U,generateSrcSet:p,generateSizes:z,getImageAttributes:j,optimizeImageUrl:R,convertToProxyUrl:c,getBestImageVariant:I,config:b(()=>i)}}const J={key:0,class:"absolute inset-0 flex items-center justify-center bg-gradient-to-br from-gray-100 via-gray-50 to-white"},Q={class:"flex flex-col items-center space-y-3"},X={key:0,class:"h-2 w-16 bg-gray-300 rounded animate-pulse"},Y={key:1,class:"absolute inset-0 flex items-center justify-center bg-gradient-to-br from-red-50 via-gray-50 to-white"},ee={class:"flex flex-col items-center space-y-2 text-center p-4"},te={class:"text-xs text-red-600 font-medium"},ae={key:2,class:"absolute inset-0 z-10"},re={key:4,class:"absolute bottom-0 left-0 right-0 bg-black/75 text-white text-xs p-2 font-mono"},M=3,le=O({__name:"ResponsiveImage",props:{src:{},alt:{},fallback:{},containerClass:{default:""},imageClass:{default:""},containerStyle:{},sizes:{},loading:{default:"lazy"},fetchPriority:{default:"auto"},enableHoverZoom:{type:Boolean,default:!1},blurOnError:{type:Boolean,default:!1},showLoadingText:{type:Boolean,default:!1},errorText:{},badge:{},badgePosition:{default:"top-right"},badgeVariant:{default:"default"},showDebugInfo:{type:Boolean,default:!1},enableRetry:{type:Boolean,default:!0},preload:{type:Boolean,default:!1},quality:{default:80}},emits:["load","error","loadStart"],setup(E,{emit:i}){const e=E,g=i,{isLoading:f,hasError:c,isLoaded:I,screenWidth:p,getImageAttributes:z,getOptimizedImageSrc:U,loadImage:k,preloadImage:V,config:C}=G({lazy:e.loading==="lazy",fallbackUrl:e.fallback}),h=B(""),m=B(0),S=!1,$=window.devicePixelRatio||1,j=b(()=>z(e.src,e.alt,{sizes:e.sizes,loading:e.loading,fetchPriority:e.fetchPriority,fallbackSrc:e.fallback})),R=b(()=>{const t=typeof e.src=="string"?"URL":e.src?"Responsive":"Fallback";let l="N/A";return typeof e.src=="object"&&e.src&&(p.value<=C.value.breakpoints.mobile?l=e.src.thumbnail?"thumbnail":"fallback":p.value<=C.value.breakpoints.tablet?l=e.src.medium?"medium":"fallback":l=e.src.large?"large":"fallback"),{source:t,selectedVariant:l,retryCount:m.value}}),a=async()=>{if(!e.src){h.value=U(null,e.fallback);return}try{g("loadStart"),h.value=await k(e.src,e.fallback),m.value=0}catch(t){e.enableRetry&&m.value<M?(m.value++,setTimeout(a,1e3*m.value)):(h.value=U(null,e.fallback),g("error",t))}},o=()=>{g("load",h.value)},r=()=>{e.enableRetry&&m.value<M?(m.value++,setTimeout(a,1e3*m.value)):g("error",new Error("Image failed to load"))};return W(()=>e.src,a,{immediate:!0}),W(()=>e.preload,t=>{t&&e.src&&V(e.src,e.fetchPriority==="high"?"high":"low")},{immediate:!0}),(t,l)=>(w(),y("div",{class:D(["relative overflow-hidden",t.containerClass,{"animate-pulse bg-gray-200":s(f),"bg-red-50":s(c)&&!s(f)}]),style:_(t.containerStyle)},[s(f)?(w(),y("div",J,[u("div",Q,[l[0]||(l[0]=u("div",{class:"w-8 h-8 bg-gray-300 rounded-lg flex items-center justify-center animate-pulse"},[u("svg",{class:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})])],-1)),t.showLoadingText?(w(),y("div",X)):P("",!0)])])):s(c)&&!h.value?(w(),y("div",Y,[u("div",ee,[l[1]||(l[1]=u("div",{class:"w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center"},[u("svg",{class:"w-5 h-5 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"})])],-1)),u("span",te,x(t.errorText||"Error al cargar imagen"),1)])])):P("",!0),q(u("img",N(j.value,{class:["w-full h-full object-cover transition-all duration-300",t.imageClass,{"opacity-0":s(f),"opacity-100":!s(f)&&s(I),"hover:scale-105":t.enableHoverZoom&&!s(f),"filter blur-sm":t.blurOnError&&s(c)}],onLoad:o,onError:r}),null,16),[[H,!s(f)&&h.value]]),t.$slots.overlay?(w(),y("div",ae,[Z(t.$slots,"overlay",{loading:s(f),error:s(c),loaded:s(I)},void 0,!0)])):P("",!0),t.badge&&!s(f)?(w(),y("div",{key:3,class:D(["absolute z-20 px-2 py-1 text-xs font-semibold rounded-md backdrop-blur-sm border transition-all duration-300",t.badgePosition==="top-left"?"top-2 left-2":t.badgePosition==="top-right"?"top-2 right-2":t.badgePosition==="bottom-left"?"bottom-2 left-2":"bottom-2 right-2",t.badgeVariant==="primary"?"bg-blue-500/90 text-white border-blue-400/30":t.badgeVariant==="success"?"bg-green-500/90 text-white border-green-400/30":t.badgeVariant==="warning"?"bg-yellow-500/90 text-white border-yellow-400/30":t.badgeVariant==="danger"?"bg-red-500/90 text-white border-red-400/30":"bg-white/90 text-gray-700 border-white/50"])},x(t.badge),3)):P("",!0),t.showDebugInfo&&s(S)?(w(),y("div",re,[u("div",null,"Source: "+x(R.value.source),1),u("div",null,"Size: "+x(R.value.selectedVariant),1),u("div",null,"Screen: "+x(s(p))+"px",1),u("div",null,"DPR: "+x(s($)),1)])):P("",!0)],6))}}),ne=K(le,[["__scopeId","data-v-4f7df0d1"]]);export{ne as R};
