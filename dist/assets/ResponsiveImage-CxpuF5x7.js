import{r as E,f as S,K as W,j as b,w as A,d as O,c as v,o as w,x as _,n as D,q as s,g as R,B as H,a as c,t as x,L as N,I as q,i as Z}from"./index-DufdCJdL.js";import{_ as K}from"./AppLayout-BF_5kZt5.js";function G(U={}){const d={fallbackUrl:"/placeholder-project.svg",lazy:!0,enableProxy:!1,breakpoints:{mobile:768,tablet:1024,desktop:1920},quality:{thumbnail:60,medium:75,large:85,original:90},retryConfig:{maxAttempts:3,retryDelay:1e3},loadingTimeout:1e4,...U},a=E({loading:!1,error:!1,loaded:!1,currentSrc:"",retryCount:0,hasTriedFallback:!1}),g=E(window.innerWidth),f=()=>{g.value=window.innerWidth};S(()=>{window.addEventListener("resize",f)}),W(()=>{window.removeEventListener("resize",f)});const u=t=>t&&(t.includes("app.tierrasonada.com")?t.replace("https://app.tierrasonada.com","").replace("http://app.tierrasonada.com",""):t),I=t=>{if(!t)return null;const l=window.devicePixelRatio||1;g.value*l;let r;g.value<=d.breakpoints.mobile?r=400*l:g.value<=d.breakpoints.tablet?r=800*l:r=1200*l;const e=[t.thumbnail,t.medium,t.large,t.original].filter(Boolean);return e.length===0?null:e.reduce((i,n)=>{if(!n.width)return n;if(!i.width)return i;const y=Math.abs(n.width-r),C=Math.abs(i.width-r);return n.width>=r&&i.width>=r?n.width<i.width?n:i:n.width<r&&i.width<r?n.width>i.width?n:i:y<C?n:i})},p=t=>t?[t.thumbnail,t.medium,t.large,t.original].filter(Boolean).filter(r=>r.width).map(r=>`${u(r.url)} ${r.width}w`).join(", "):"",z=t=>t||[`(max-width: ${d.breakpoints.mobile}px) 100vw`,`(max-width: ${d.breakpoints.tablet}px) 50vw`,"33vw"].join(", "),P=async(t,l)=>{if(a.value.error=!0,!a.value.hasTriedFallback&&t){a.value.hasTriedFallback=!0;const r=[t.medium,t.thumbnail,t.large,t.original].filter(e=>e&&e.url!==a.value.currentSrc);if(r.length>0){const e=r[0];return u(e.url)}}return l&&l!==a.value.currentSrc?u(l):d.fallbackUrl},k=(t,l)=>{if(console.log("ðŸŽ¯ getOptimizedImageSrc called with:",{responsiveSet:t,fallbackSrc:l,type:typeof t}),typeof t=="string"){const e=u(t)||l||d.fallbackUrl;return console.log("ðŸŽ¯ String URL result:",e),e}if(t){const e=I(t);if(console.log("ðŸŽ¯ Best variant found:",e),e){const o=u(e.url);return console.log("ðŸŽ¯ Responsive set result:",o),o}}const r=u(l||"")||d.fallbackUrl;return console.log("ðŸŽ¯ Fallback result:",r),r},V=async(t,l)=>{a.value.loading=!0,a.value.error=!1,a.value.loaded=!1,a.value.retryCount=0,a.value.hasTriedFallback=!1;const r=async(e,o=1)=>new Promise((i,n)=>{const y=new Image,C=setTimeout(()=>{y.onload=null,y.onerror=null,n(new Error("Image load timeout"))},d.loadingTimeout);y.onload=()=>{clearTimeout(C),a.value.loading=!1,a.value.loaded=!0,a.value.error=!1,a.value.currentSrc=e,i(e)},y.onerror=async()=>{if(clearTimeout(C),o<d.retryConfig.maxAttempts)setTimeout(()=>{r(e,o+1).then(i).catch(n)},d.retryConfig.retryDelay*o);else try{const B=await P(typeof t=="string"?null:t,l);B!==e?r(B,1).then(i).catch(n):n(new Error("All fallback options exhausted"))}catch(B){n(B)}},y.src=e});try{const e=k(t,l);return await r(e)}catch(e){return a.value.loading=!1,a.value.error=!0,console.warn("Image loading failed:",e),d.fallbackUrl}},L=(t,l="low")=>new Promise(r=>{const e=k(t),o=document.createElement("link");o.rel="preload",o.as="image",o.href=e,l==="high"&&o.setAttribute("fetchpriority","high"),o.onload=()=>r(),o.onerror=()=>r(),document.head.appendChild(o)}),h=b(()=>a.value.loading),m=b(()=>a.value.error),j=b(()=>a.value.loaded),F=b(()=>a.value.currentSrc),$=(t,l,r={})=>{const e=k(t,r.fallbackSrc),o=typeof t=="object"?p(t):"";return{src:e,srcset:o||void 0,sizes:r.sizes?z(r.sizes):z(),alt:l,loading:r.loading||(d.lazy?"lazy":"eager"),fetchpriority:r.fetchPriority,crossorigin:"anonymous"}},T=(t,l,r,e)=>{if(!t)return d.fallbackUrl;const o=u(t);if(l||r||e){const i=new URLSearchParams;l&&i.set("w",l.toString()),r&&i.set("h",r.toString()),e&&i.set("q",e.toString());const n=o.includes("?")?"&":"?";return`${o}${n}${i.toString()}`}return o};return A(g,()=>{}),{isLoading:h,hasError:m,isLoaded:j,currentSource:F,screenWidth:b(()=>g.value),getOptimizedImageSrc:k,loadImage:V,preloadImage:L,handleImageError:P,generateSrcSet:p,generateSizes:z,getImageAttributes:$,optimizeImageUrl:T,convertToProxyUrl:u,getBestImageVariant:I,config:b(()=>d)}}const J={key:0,class:"absolute inset-0 flex items-center justify-center bg-gradient-to-br from-gray-100 via-gray-50 to-white"},Q={class:"flex flex-col items-center space-y-3"},X={key:0,class:"h-2 w-16 bg-gray-300 rounded animate-pulse"},Y={key:1,class:"absolute inset-0 flex items-center justify-center bg-gradient-to-br from-red-50 via-gray-50 to-white"},ee={class:"flex flex-col items-center space-y-2 text-center p-4"},te={class:"text-xs text-red-600 font-medium"},ae={key:2,class:"absolute inset-0 z-10"},re={key:4,class:"absolute bottom-0 left-0 right-0 bg-black/75 text-white text-xs p-2 font-mono"},M=3,oe=O({__name:"ResponsiveImage",props:{src:{},alt:{},fallback:{},containerClass:{default:""},imageClass:{default:""},containerStyle:{},sizes:{},loading:{default:"lazy"},fetchPriority:{default:"auto"},enableHoverZoom:{type:Boolean,default:!1},blurOnError:{type:Boolean,default:!1},showLoadingText:{type:Boolean,default:!1},errorText:{},badge:{},badgePosition:{default:"top-right"},badgeVariant:{default:"default"},showDebugInfo:{type:Boolean,default:!1},enableRetry:{type:Boolean,default:!0},preload:{type:Boolean,default:!1},quality:{default:80}},emits:["load","error","loadStart"],setup(U,{emit:d}){const a=U,g=d,{isLoading:f,hasError:u,isLoaded:I,screenWidth:p,getImageAttributes:z,getOptimizedImageSrc:P,loadImage:k,preloadImage:V,config:L}=G({lazy:a.loading==="lazy",fallbackUrl:a.fallback}),h=E(""),m=E(0),j=!1,F=window.devicePixelRatio||1,$=b(()=>z(a.src,a.alt,{sizes:a.sizes,loading:a.loading,fetchPriority:a.fetchPriority,fallbackSrc:a.fallback})),T=b(()=>{const e=typeof a.src=="string"?"URL":a.src?"Responsive":"Fallback";let o="N/A";return typeof a.src=="object"&&a.src&&(p.value<=L.value.breakpoints.mobile?o=a.src.thumbnail?"thumbnail":"fallback":p.value<=L.value.breakpoints.tablet?o=a.src.medium?"medium":"fallback":o=a.src.large?"large":"fallback"),{source:e,selectedVariant:o,retryCount:m.value}}),t=async()=>{if(!a.src){h.value=P(null,a.fallback);return}try{g("loadStart"),h.value=await k(a.src,a.fallback),m.value=0}catch(e){console.warn("ðŸ“¸ ResponsiveImage: Failed to load image",e),a.enableRetry&&m.value<M?(m.value++,setTimeout(t,1e3*m.value)):(h.value=P(null,a.fallback),g("error",e))}},l=()=>{g("load",h.value)},r=()=>{a.enableRetry&&m.value<M?(m.value++,setTimeout(t,1e3*m.value)):g("error",new Error("Image failed to load"))};return A(()=>a.src,t,{immediate:!0}),A(()=>a.preload,e=>{e&&a.src&&V(a.src,a.fetchPriority==="high"?"high":"low")},{immediate:!0}),(e,o)=>(w(),v("div",{class:D(["relative overflow-hidden",e.containerClass,{"animate-pulse bg-gray-200":s(f),"bg-red-50":s(u)&&!s(f)}]),style:_(e.containerStyle)},[s(f)?(w(),v("div",J,[c("div",Q,[o[0]||(o[0]=c("div",{class:"w-8 h-8 bg-gray-300 rounded-lg flex items-center justify-center animate-pulse"},[c("svg",{class:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[c("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})])],-1)),e.showLoadingText?(w(),v("div",X)):R("",!0)])])):s(u)&&!h.value?(w(),v("div",Y,[c("div",ee,[o[1]||(o[1]=c("div",{class:"w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center"},[c("svg",{class:"w-5 h-5 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[c("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"})])],-1)),c("span",te,x(e.errorText||"Error al cargar imagen"),1)])])):R("",!0),H(c("img",q($.value,{class:["w-full h-full object-cover transition-all duration-300",e.imageClass,{"opacity-0":s(f),"opacity-100":!s(f)&&s(I),"hover:scale-105":e.enableHoverZoom&&!s(f),"filter blur-sm":e.blurOnError&&s(u)}],onLoad:l,onError:r}),null,16),[[N,!s(f)&&h.value]]),e.$slots.overlay?(w(),v("div",ae,[Z(e.$slots,"overlay",{loading:s(f),error:s(u),loaded:s(I)},void 0,!0)])):R("",!0),e.badge&&!s(f)?(w(),v("div",{key:3,class:D(["absolute z-20 px-2 py-1 text-xs font-semibold rounded-md backdrop-blur-sm border transition-all duration-300",e.badgePosition==="top-left"?"top-2 left-2":e.badgePosition==="top-right"?"top-2 right-2":e.badgePosition==="bottom-left"?"bottom-2 left-2":"bottom-2 right-2",e.badgeVariant==="primary"?"bg-blue-500/90 text-white border-blue-400/30":e.badgeVariant==="success"?"bg-green-500/90 text-white border-green-400/30":e.badgeVariant==="warning"?"bg-yellow-500/90 text-white border-yellow-400/30":e.badgeVariant==="danger"?"bg-red-500/90 text-white border-red-400/30":"bg-white/90 text-gray-700 border-white/50"])},x(e.badge),3)):R("",!0),e.showDebugInfo&&s(j)?(w(),v("div",re,[c("div",null,"Source: "+x(T.value.source),1),c("div",null,"Size: "+x(T.value.selectedVariant),1),c("div",null,"Screen: "+x(s(p))+"px",1),c("div",null,"DPR: "+x(s(F)),1)])):R("",!0)],6))}}),ne=K(oe,[["__scopeId","data-v-2be9c643"]]);export{ne as R};
